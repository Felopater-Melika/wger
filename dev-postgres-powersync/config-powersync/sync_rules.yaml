# See Documentation for more information:
# https://docs.powersync.com/usage/sync-rules
# Note that changes to this file are not watched.
# The service needs to be restarted for changes to take effect.
# Warning, parameter queries have a limit of 1000 rows (before filtering)!
bucket_definitions:
  global:
    data:
      - select * from exercises_muscle
  by_user_id:
    parameters: SELECT token_parameters.user_id as user_id
    data:
      - select * from ivm_nutrition_nutritionplan as nutrition_nutritionplan where user_id = bucket.user_id
      - select * from ivm_nutrition_meal as nutrition_meal where user_id = bucket.user_id
      - select * from ivm_nutrition_mealitem as nutrition_mealitem where user_id = bucket.user_id
      - select * from ivm_nutrition_logitem as nutrition_logitem where user_id = bucket.user_id
  # "too many buckets" errors
 # meal_item_ingredients: # note: we are restricted by <=1000 distinct ingredient_id values here
 #   parameters: select ingredient_id as ingredient_id FROM ivm_nutrition_mealitem WHERE user_id = token_parameters.user_id
 #   data:
 #     - select * from nutrition_ingredient WHERE ingredient_id = bucket.ingredient_id
 #     - select * from nutrition_image WHERE ingredient_id = bucket.ingredient_id
 # log_item_ingredients:
 #   parameters: select ingredient_id as ingredient_id FROM ivm_nutrition_logitem WHERE user_id = token_parameters.user_id
 #   data:
 #     - select * from nutrition_ingredient WHERE ingredient_id = bucket.ingredient_id
 #     - select * from nutrition_image WHERE ingredient_id = bucket.ingredient_id
